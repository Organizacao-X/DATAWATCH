<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>DATAWATCH | Administração</title>

    <script src="./js/funcoes.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>


    <link rel="icon" href="./assets/imgs/LOGOV2.png">
    <link rel="stylesheet" href="./css/areaADM.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
</head>

<!-- <body onload="mostrarConteudo()" onload="drawChart()"> -->

<body onload="mostrarConteudo()">
    <!-- NAVBAR -->
    <header>
        <nav class="nav-bar">
            <div class="hamburger-menu">
                <input id="menu__toggle" type="checkbox" />
                <label class="menu__btn" for="menu__toggle">
                    <span></span>
                </label>



                <ul class="menu__box">
                    <div class="image">
                        <img src="../public/assets/imgs/imagem-do-usuario-com-fundo-preto.png" alt=""
                            style="height: 200px; width: 200px; border-radius: 50%; ">
                    </div>
                    <div class="nomeUser">
                        <span id="lateral_menu_adm_name"></span>
                    </div>
                    <li id="lateral_menu_cad_empresa" style="display: none;"><a class="menu__item"
                            href="./cadastroEmpresa.html">Cadastrar
                            empresa</a></li>
                    <li><a class="menu__item" href="./areaADM.html">Home</a></li>
                    <li id="lateral_menu_cad_maquina"><a class="menu__item" href="./cadastromaquina.html">Cadastrar
                            maquina</a></li>
                    <li id="lateral_menu_cad_funcionario"><a class="menu__item"
                            href="./cadastroFuncionario.html">Cadastrar funcionário</a></li>
                    <li><a class="menu__item" href="#">Logout</a></li>
                </ul>
            </div>



            <div class="logo">
                <img src="assets/imgs/LOGOcomTextoV2.png" alt="" width="150px">
            </div>
        </nav>

    </header>

    <section>
        <div class="usuario">
            <span>Seja bem-vindo, <span id="nome_usuario"></span> </span>
        </div>

        <!-- TODO: ESTILIZAR ESSA DIV -->
        <div id="esperando_verificacao" style="display: none; text-align: center;">
            <br>
            Estamos no processo de verificação da sua empresa!
        </div>

        <div id="empresa_a_cadastrar" style="display: none; text-align: center;">
            <br>
            Você ainda não cadastrou nenhuma empresa. <a href="./cadastroEmpresa.html">Cadastre sua empresa
                agora!</a>
        </div>


        <div id="div_maquinas" class="bg" style="display: none;">
            <div class="container">
                <h2>Maquina</h2>
                <ul id="ul_cards_maquinas" class="cards"></ul>
            </div>
        </div>
    </section>

    <section>
        <div id="div_funcionarios" class="bg-funcionario" style="display: none;">
            <div class="titulo-funcionario">
                <span><b>Funcionários</b></span>
            </div>
            <div class="lista-funcionario">
                <ul id="ul_lista_funcionario"></ul>
            </div>
        </div>
    </section>

    <!-- <li class="funcionario">
                        <div class="info-funcionario">
                            <span>Fernando</span>
                            <div class="content-funcionario">
                                <div class="conexao">
                                    <div class="status-funcionario" id=""></div>
                                    <span id="">Online</span>
                                </div>
                                <div class="mostrar">
                                    <div class="excluir">
                                        <button onclick="verificar()">
                                            <div class="botao">
                                                <div class="x"></div>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>

                    <li class="funcionario">
                        <div class="info-funcionario">
                            <span>Lucas</span>
                            <div class="content-funcionario">
                                <div class="conexao">
                                    <div class="status-funcionario2" id=""></div>
                                    <span id="">Offline</span>
                                </div>
                                <div class="mostrar">
                                    <div class="excluir">
                                        <button onclick="verificar()">
                                            <div class="botao">
                                                <div class="x"></div>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>

                    <li class="funcionario">
                        <div class="info-funcionario">
                            <span>André</span>
                            <div class="content-funcionario">
                                <div class="conexao">
                                    <div class="status-funcionario" id=""></div>
                                    <span id="">Online</span>
                                </div>
                                <div class="mostrar">
                                    <div class="excluir">
                                        <button onclick="verificar()">
                                            <div class="botao">
                                                <div class="x"></div>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>

                    <li class="funcionario">
                        <div class="info-funcionario">
                            <span>Sara</span>
                            <div class="content-funcionario">
                                <div class="conexao">
                                    <div class="status-funcionario" id=""></div>
                                    <span id="">Online</span>
                                </div>
                                <div class="mostrar">
                                    <div class="excluir">
                                        <button onclick="verificar()">
                                            <div class="botao">
                                                <div class="x"></div>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>

                    <li class="funcionario">
                        <div class="info-funcionario">
                            <span>Mateus</span>
                            <div class="content-funcionario">
                                <div class="conexao">
                                    <div class="status-funcionario2" id=""></div>
                                    <span id="">Offline</span>
                                </div>
                                <div class="mostrar">
                                    <div class="excluir">
                                        <button onclick="verificar()">
                                            <div class="botao">
                                                <div class="x"></div>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li> -->


    <!-- <li class="card">
                        <div>
                            <h3 class="card-title">Maquina 1</h3>


                        </div>
                        <div class="card-link-wrapper">

                            <div id="piechart1" style="width: 400px; height: 150px;"></div>

                            <div class="content">
                                <div class="status" id=""></div><span id="">Ativa</span>
                            </div>

                        </div>
                    </li> -->
    <!-- <li class="card">
                        <div>
                            <h3 class="card-title">Maquina 2</h3>


                        </div>
                        <div class="card-link-wrapper">

                            <div id="piechart2" style="width: 400px; height: 150px;"></div>

                            <div class="content">
                                <div class="status" id=""></div><span id="">Ativa</span>
                            </div>

                        </div>
                    </li> -->
    <!-- <li class="card">
                        <div>
                            <h3 class="card-title">Maquina 3</h3>


                        </div>
                        <div class="card-link-wrapper">

                            <div id="piechart3" style="width: 400px; height: 150px;"></div>

                            <div class="content">
                                <div class="status" id=""></div><span id="">Ativa</span>
                            </div>

                        </div>
                    </li> -->
    <!-- <li class="card">
                        <div>
                            <h3 class="card-title">Maquina 4</h3>


                        </div>
                        <div class="card-link-wrapper">

                            <div id="piechart4" style="width: 400px; height: 150px;"></div>

                            <div class="content">
                                <div class="status" id=""></div><span id="">Ativa</span>
                            </div>

                        </div>
                    </li> -->

                    

</body>
<script type="text/javascript">
    var lista_maquinas = document.getElementById("ul_cards_maquinas");

    function verificar() {
        alert("teste funcionou")

    }

    // nomeUsuario.innerHTML = `<p>${sessionStorage.NOME_USUARIO}</p>`

    // function cadastrosvisiveis() {

    //     if (sessionStorage.ID_EMPRESA != 0 || sessionStorage.ID_EMPRESA == undefined || sessionStorage.ID_EMPRESA == null) {
    //         funcionario.style.visibility = 'visible'
    //         maquina.style.visibility = 'visible'
    //     }
    // }

    function mostrarConteudo() {
        fetch("/datawatch/consultarStatusEmpresa", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                idUsuarioServer: sessionStorage.ID_USUARIO
            })
        }).then(function (resposta) {

            if (resposta.ok) {
                resposta.json().then(dados => {
                    console.log(dados)
                    // verifica se existe alguma empresa relacionada com esse usuário no banco de dados
                    // mostra o conteúdo da tela caso exista, não mostra caso não exista
                    if (dados.length == 0) {
                        alert("Nenhuma empresa cadastrada")
                        empresa_a_cadastrar.style = "display: block; text-align: center;"
                        lateral_menu_cad_maquina.style = "display: none;"
                        lateral_menu_cad_funcionario.style = "display: none;"
                        lateral_menu_cad_empresa.style = "display: block;"
                        div_maquinas.style = "display: none;"
                        div_funcionarios.style = "display: none;"
                        nome_usuario.innerHTML = sessionStorage.NOME_USUARIO;
                        lateral_menu_adm_name.innerHTML = `Bem-vindo, ${sessionStorage.NOME_USUARIO}!`;
                    } else if (dados[0].verificado == 0) {
                        var idEmpresa = dados[0].fkEmpresa;
                        sessionStorage.ID_EMPRESA = idEmpresa
                        alert("Empresa ainda nao foi verificada")
                        esperando_verificacao.style = "display: block; text-align: center;"
                        lateral_menu_cad_maquina.style = "display: none;"
                        lateral_menu_cad_funcionario.style = "display: none;"
                        div_maquinas.style = "display: none;"
                        div_funcionarios.style = "display: none;"
                        nome_usuario.innerHTML = sessionStorage.NOME_USUARIO;
                        lateral_menu_adm_name.innerHTML = `Bem-vindo, ${sessionStorage.NOME_USUARIO}!`;

                    } else {
                        div_maquinas.style = "display: block;"
                        div_funcionarios.style = "display: block;"
                        nome_usuario.innerHTML = dados[0].nomeUsuario
                        var idEmpresa = dados[0].fkEmpresa;
                        sessionStorage.ID_EMPRESA = idEmpresa

                        mostrarMaquinas(idEmpresa);
                        mostrarFuncionarios(idEmpresa);
                    }
                })
            }
            else {
                throw (JSON.stringify(resposta))
            }
        }).catch(function (resposta) {
            console.log(`ERRO: ${resposta}`);
        })
        return false
    }


    function mostrarMaquinas(idEmpresa) {
        fetch("/datawatch/pegarMaquinas", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                idEmpresaServer: idEmpresa
            })
        }).then(function (resposta) {

            if (resposta.ok) {
                resposta.json().then(dados => {
                    console.log(dados)
                    if (dados.length > 0) {
                        dados.forEach(maquina => {
                            carregarMaquinaTela(maquina)
                            console.log(lista_maquinas)
                        });
                    }
                })
            }
            else {
                throw (JSON.stringify(resposta))
            }
        }).catch(function (resposta) {
            console.log(`ERRO: ${resposta}`);
        })
        return false
    }

    function mostrarFuncionarios(idEmpresa) {
        fetch("/datawatch/pegarFuncionarios", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                idEmpresaServer: idEmpresa
            })
        }).then(function (resposta) {

            if (resposta.ok) {
                resposta.json().then(dados => {
                    console.log(dados)
                    if (dados.length > 0) {
                        dados.forEach(funcionario => {
                            carregarFuncionarioTela(funcionario)

                        });
                    }
                })
            }
            else {
                throw (JSON.stringify(resposta))
            }
        }).catch(function (resposta) {
            console.log(`ERRO: ${resposta}`);
        })
        return false
    }

    function carregarFuncionarioTela(funcionario) {
        var li = document.createElement("li")
        li.setAttribute("class", "funcionario")

        var divInfoFuncionario = document.createElement("div")
        divInfoFuncionario.setAttribute("class", "info-funcionario")

        var spanNome = document.createElement("span")
        spanNome.innerHTML = funcionario.nomeUsuario

        var divContentFuncionario = document.createElement("div")
        divContentFuncionario.setAttribute("class", "content-funcionario")

        var divConexao = document.createElement("div")
        divConexao.setAttribute("class", "conexao")

        var divStatusFuncionario = document.createElement("div")
        var spanStatus = document.createElement("span")

        if (funcionario.statusUsuario == 1) {
            divStatusFuncionario.setAttribute("class", "status-funcionario")
            spanStatus.innerHTML = "Online"
        } else {
            divStatusFuncionario.setAttribute("class", "status-funcionario2")
            spanStatus.innerHTML = "Offline"
        }
        
        var divMostrar = document.createElement("div")
        divMostrar.setAttribute("class", "mostrar")

        var divExcluir = document.createElement("div")
        divExcluir.setAttribute("class", "excluir")

        var btnExcluir = document.createElement("button")
        
        var divBotao = document.createElement("div")
        divBotao.setAttribute("class", "botao")

        var divBotaoX = document.createElement("div")
        divBotaoX.setAttribute("class", "x")

        divBotao.appendChild(divBotaoX)
        btnExcluir.appendChild(divBotao)
        divExcluir.appendChild(divBotao)
        divMostrar.appendChild(divExcluir)

        divConexao.appendChild(divStatusFuncionario)
        divConexao.appendChild(spanStatus)

        divContentFuncionario.appendChild(divConexao)
        divContentFuncionario.appendChild(divMostrar)

        divInfoFuncionario.appendChild(spanNome)
        divInfoFuncionario.appendChild(divContentFuncionario)

        li.appendChild(divInfoFuncionario)
        
        ul_lista_funcionario.appendChild(li)
    }
    
    function carregarMaquinaTela(maquina) {
        var li = document.createElement("li")
        li.setAttribute("class", "card")

        var divTitle = document.createElement("div")

        var h3Title = document.createElement("h3")
        h3Title.setAttribute("class", "card-title")
        h3Title.innerHTML = maquina.nomeMaquina

        divTitle.appendChild(h3Title)

        var divCardLinkWrapper = document.createElement("div")
        divCardLinkWrapper.setAttribute("class", "card-link-wrapper")

        var divPiechart1 = document.createElement("div")
        divPiechart1.setAttribute("id", "piechart1")
        divPiechart1.style = "width: 400px; height: 150px;"

        var divContent = document.createElement("div")
        divContent.setAttribute("class", "content")

        var divStatus = document.createElement("div")
        var spanStatus = document.createElement("span")

        if (maquina.statusSistema == 1) {
            divStatus.setAttribute("class", "status")
            spanStatus.innerHTML = "Online"
        } else {
            divStatus.setAttribute("class", "status2")
            spanStatus.innerHTML = "Offline"
        }


        divContent.appendChild(divStatus)
        divContent.appendChild(spanStatus)

        divCardLinkWrapper.appendChild(divPiechart1)
        divCardLinkWrapper.appendChild(divContent)

        li.appendChild(divTitle)
        li.appendChild(divCardLinkWrapper)

        lista_maquinas.appendChild(li)
    }

    // Gráficos

    // google.charts.load('current', { 'packages': ['corechart'] });
    // google.charts.setOnLoadCallback(drawChart1);

    // function drawChart1() {

    //     var data = google.visualization.arrayToDataTable([
    //         ['Minutos', 'Tempo em Atividade'],
    //         ['', 0],
    //         ['', 88],
    //         ['', 144],
    //         ['', 0],
    //         ['', 32]
    //     ]);

    //     var options = {
    //         title: 'Tempo de funcionamento',
    //         curveType: 'function',
    //         legend: { position: 'bottom' }
    //     };

    //     var chart = new google.visualization.LineChart(document.getElementById('piechart1'));
    //     // confidencial = document.getElementById("RedeTitulo");


    //     chart.draw(data, options);
    // }

    // google.charts.load('current', { 'packages': ['corechart'] });
    // google.charts.setOnLoadCallback(drawChart2);

    // function drawChart2() {

    //     var data = google.visualization.arrayToDataTable([
    //         ['Minutos', 'Tempo em Atividade'],
    //         ['', 4],
    //         ['', 99],
    //         ['', 200],
    //         ['', 78],
    //         ['', 0]
    //     ]);

    //     var options = {
    //         title: 'Internet em kbps',
    //         curveType: 'function',
    //         legend: { position: 'bottom' }
    //     };

    //     var chart = new google.visualization.LineChart(document.getElementById('piechart2'));
    //     // confidencial = document.getElementById("RedeTitulo");


    //     chart.draw(data, options);
    // }

    // google.charts.load('current', { 'packages': ['corechart'] });
    // google.charts.setOnLoadCallback(drawChart3);

    // function drawChart3() {

    //     var data = google.visualization.arrayToDataTable([
    //         ['Minutos', 'Tempo em Atividade'],
    //         ['', 42],
    //         ['', 444],
    //         ['', 25],
    //         ['', 75],
    //         ['', 65]
    //     ]);

    //     var options = {
    //         title: 'Internet em kbps',
    //         curveType: 'function',
    //         legend: { position: 'bottom' }
    //     };

    //     var chart = new google.visualization.LineChart(document.getElementById('piechart3'));
    //     // confidencial = document.getElementById("RedeTitulo");


    //     chart.draw(data, options);
    // }

    // google.charts.load('current', { 'packages': ['corechart'] });
    // google.charts.setOnLoadCallback(drawChart4);

    // function drawChart4() {

    //     var data = google.visualization.arrayToDataTable([
    //         ['Minutos', 'Tempo em Atividade'],
    //         ['', 0],
    //         ['', 324],
    //         ['', 245],
    //         ['', 75],
    //         ['', 86]
    //     ]);

    //     var options = {
    //         title: 'Internet em kbps',
    //         curveType: 'function',
    //         legend: { position: 'bottom' }
    //     };

    //     var chart = new google.visualization.LineChart(document.getElementById('piechart4'));
    //     // confidencial = document.getElementById("RedeTitulo");


    //     chart.draw(data, options);
    // }

</script>